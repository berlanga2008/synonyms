$.Synonyms=function(t,e){this.$el=$(t);try{document.execCommand("enableObjectResizing",!1,"false")}catch(n){console.log("error in disabling eneableObjectResizing")}this.thesaurusRaw=e.thesaurusRaw,this.settings={trimSynonyms:e.trimSynonyms||!0,maxSynonyms:e.maxSynonyms||6,shuffleSynonyms:e.shuffleSynonyms||!0,replaceCallback:e.replaceCallback,characterCountLimit:e.characterCountLimit||void 0},this.buildThesaurus(),this.tagSynonyms(this.$el.get(0)),this.$el.on("keyup keydown",function(t){var e=t.which;8===e||46===e?($(document).find(".synonym-list").hide(),""==this.val()?(this.resetCaret(this.$el.get(0)),this.$el.find("br").remove()):this.removeSpan()):(0===e||32===e)&&this.escapeSpan();var n=e>47&&58>e||32==e||13==e||e>64&&91>e||e>95&&112>e||e>185&&193>e||e>218&&223>e;n&&!(t.ctrlKey||t.metaKey||t.altKey)&&void 0!==this.settings.characterCountLimit&&this.val().length>=this.settings.characterCountLimit&&t.preventDefault(),this.tagSynonyms(this.$el.get(0))}.bind(this)),"ajax"===this.method&&(this.lookup=this.ajaxLookup),this.$el.find("br").remove(),this.val=function(t){return void 0===t?this.$el.ignore("ul").text().replace(/[\u200B-\u200D\uFEFF\u00A0]/g,""):void this.$el.text(t)}.bind(this)},$.Synonyms.prototype.buildThesaurus=function(){this.thesaurus={},$.each(this.thesaurusRaw,function(t){$.each(this.thesaurusRaw[t],function(e,n){synonyms=this.thesaurusRaw[t].slice(),synonyms.splice(e,1),this.thesaurus[n]=synonyms}.bind(this))}.bind(this))},$.Synonyms.prototype.lookup=function(t){return this.thesaurus[t.toLowerCase()]},$.Synonyms.prototype.ajaxLookup=function(t){},$.Synonyms.prototype.placeCaretAfterNode=function(t){var e,n=document.createRange(),s=window.getSelection();n.setStartAfter(t),t.nextSibling.data.length>0?n.setStart(t.nextSibling,1):(e=document.createTextNode("â€‹"),n.insertNode(e),n.setStartAfter(e)),n.collapse(!0),s.removeAllRanges(),s.addRange(n)},$.Synonyms.prototype.resetCaret=function(t){var e=document.createRange(),n=window.getSelection();e.selectNodeContents(t),e.collapse(!1),n.removeAllRanges(),n.addRange(e)},$.Synonyms.prototype.escapeSpan=function(){var t,e;window.getSelection&&(e=window.getSelection(),e.getRangeAt&&e.rangeCount>0&&(t=e.getRangeAt(0))),t&&(container=t.commonAncestorContainer,3===container.nodeType&&"SPAN"===container.parentNode.nodeName&&this.placeCaretAfterNode(container.parentNode))},$.Synonyms.prototype.removeSpan=function(){var t,e,n=window.getSelection(),s=document.createRange();"LI"===n.anchorNode.parentNode.nodeName&&(e=n.anchorNode.parentNode.parentNode.parentNode,t=$(e).clone().children().remove().end().text().slice(0,-1),$(e).removeClass("tagged"),e.textContent=t,s.setStartAfter(e),s.collapse(!0),n.removeAllRanges(),n.addRange(s))},$.Synonyms.prototype.tagSynonyms=function(t){for(var e=t.firstChild;e;)3==e.nodeType&&$.each(e.data.split(" "),function(t,n){var s,o,a=this.lookup(n);a&&(s=e.splitText(e.data.indexOf(n)),e=s,a=this.settings.shuffleSynonyms?this.shuffleSynonyms(a):a,a=this.settings.trimSynonyms?this.trimSynonyms(a):a,o=this.tagAndAttachEventHandlerToWord(a,n),e.parentNode.insertBefore(o.get(0),e),e.data=e.data.replace(n,""),this.placeCaretAfterNode(o.get(0)))}.bind(this)),e=e.nextSibling;return t},$.Synonyms.prototype.tagAndAttachEventHandlerToWord=function(t,e){var n,s=$('<ul class="synonym-list">'),o=this;return $.each(t,function(t,n){s.append($("<li>").text(n).on("click",function(){o.settings.replaceCallback&&o.settings.replaceCallback(e,n),$(this).closest(".tagged").text($(this).text()).removeClass("tagged").addClass("replaced")}))}),s.hide(),n=$('<span class="tagged" spellcheck="false">').text(e).append(s),n.on("click",function(){$(document).find(".synonym-list").hide(),$(this).find(".synonym-list").show()}),n},$.Synonyms.prototype.shuffleSynonyms=function(t){for(var e,n,s=t.length;0!==s;)n=Math.floor(Math.random()*s),s-=1,e=t[s],t[s]=t[n],t[n]=e;return t},$.Synonyms.prototype.trimSynonyms=function(t){return t.length>this.settings.maxSynonyms&&(t=t.slice(0,this.settings.maxSynonyms)),t},$.fn.ignore=function(t){return this.clone().find(t||">*").remove().end()},$.fn.synonyms=function(t){return this.each(function(){if(void 0===$(this).data("synonyms")){var e=new $.Synonyms(this,t);$(this).data("synonyms",e)}})};