$.Synonyms=function(e,t){this.$el=$(e);try{document.execCommand("enableObjectResizing",!1,"false")}catch(n){console.log("error in disabling eneableObjectResizing")}this.thesaurusRaw=t.thesaurusRaw,this.settings={trimSynonyms:t.trimSynonyms||!0,maxSynonyms:t.maxSynonyms||6,shuffleSynonyms:t.shuffleSynonyms||!0,replaceCallback:t.replaceCallback,characterCountLimit:t.characterCountLimit||void 0},this.buildThesaurus(),this.tagSynonyms(this.$el.get(0)),this.$el.on("keyup keydown",function(e){var t=e.which;8===t||46===t?($(document).find(".synonym-list").hide(),""==this.val()?(this.resetCaret(this.$el.get(0)),this.$el.find("br").remove()):this.backspace()):(0===t||32===t)&&this.escapeSpan();var n=t>47&&58>t||32==t||13==t||t>64&&91>t||t>95&&112>t||t>185&&193>t||t>218&&223>t;n&&!(e.ctrlKey||e.metaKey||e.altKey)&&void 0!==this.settings.characterCountLimit&&this.val().length>=this.settings.characterCountLimit&&e.preventDefault(),this.tagSynonyms(this.$el.get(0))}.bind(this)),"ajax"===this.method&&(this.lookup=this.ajaxLookup),this.$el.find("br").remove(),this.val=function(e){return void 0===e?this.$el.ignore("ul").text().replace(/[\u200B-\u200D\uFEFF\u00A0]/g,""):void this.$el.text(e)}.bind(this)},$.Synonyms.prototype.buildThesaurus=function(){this.thesaurus={},$.each(this.thesaurusRaw,function(e){$.each(this.thesaurusRaw[e],function(t,n){synonyms=this.thesaurusRaw[e].slice(),synonyms.splice(t,1),this.thesaurus[n]=synonyms}.bind(this))}.bind(this))},$.Synonyms.prototype.lookup=function(e){return this.thesaurus[e.toLowerCase()]},$.Synonyms.prototype.ajaxLookup=function(e){},$.Synonyms.prototype.placeCaretAfterNode=function(e){var t,n=document.createRange(),o=window.getSelection();n.setStartAfter(e),e.nextSibling.data.length>0?n.setStart(e.nextSibling,1):(t=document.createTextNode("â€‹"),n.insertNode(t),n.setStartAfter(t)),n.collapse(!0),o.removeAllRanges(),o.addRange(n)},$.Synonyms.prototype.resetCaret=function(e){var t=document.createRange(),n=window.getSelection();t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t)},$.Synonyms.prototype.escapeSpan=function(){var e,t;window.getSelection&&(t=window.getSelection(),t.getRangeAt&&t.rangeCount>0&&(e=t.getRangeAt(0))),e&&(container=e.commonAncestorContainer,3===container.nodeType&&"SPAN"===container.parentNode.nodeName&&this.placeCaretAfterNode(container.parentNode))},$.Synonyms.prototype.backspace=function(){var e,t,n=window.getSelection(),o=document.createRange();if("LI"===n.anchorNode.parentNode.nodeName)t=n.anchorNode.parentNode.parentNode.parentNode,e=$(t).clone().children().remove().end().text().slice(0,-1),$(t).removeClass("tagged"),t.textContent=e,o.setStartAfter(t),o.collapse(!0),n.removeAllRanges(),n.addRange(o);else if("SPAN"===n.anchorNode.parentNode.nodeName){e=$(n.anchorNode.parentNode).clone().children().remove().end().text();var s=n.anchorNode.parentNode.previousSibling;n.anchorNode.remove(),s.nodeValue+=e.slice(0,e.length-1)}},$.Synonyms.prototype.tagSynonyms=function(e){for(var t=e.firstChild;t;)3==t.nodeType&&$.each(t.data.split(" "),function(e,n){var o,s,a=this.lookup(n);a&&(o=t.splitText(t.data.indexOf(n)),t=o,a=this.settings.shuffleSynonyms?this.shuffleSynonyms(a):a,a=this.settings.trimSynonyms?this.trimSynonyms(a):a,s=this.tagAndAttachEventHandlerToWord(a,n),t.parentNode.insertBefore(s.get(0),t),t.data=t.data.replace(n,""),this.placeCaretAfterNode(s.get(0)))}.bind(this)),t=t.nextSibling;return e},$.Synonyms.prototype.tagAndAttachEventHandlerToWord=function(e,t){var n,o=$('<ul class="synonym-list">'),s=this;return $.each(e,function(e,n){o.append($("<li>").text(n).on("click",function(){s.settings.replaceCallback&&s.settings.replaceCallback(t,n),$(this).closest(".tagged").text($(this).text()).removeClass("tagged").addClass("replaced")}))}),o.hide(),n=$('<span class="tagged" spellcheck="false">').text(t).append(o),n.on("click",function(){$(document).find(".synonym-list").hide(),$(this).find(".synonym-list").show()}),n},$.Synonyms.prototype.shuffleSynonyms=function(e){for(var t,n,o=e.length;0!==o;)n=Math.floor(Math.random()*o),o-=1,t=e[o],e[o]=e[n],e[n]=t;return e},$.Synonyms.prototype.trimSynonyms=function(e){return e.length>this.settings.maxSynonyms&&(e=e.slice(0,this.settings.maxSynonyms)),e},$.fn.ignore=function(e){return this.clone().find(e||">*").remove().end()},$.fn.synonyms=function(e){return this.each(function(){if(void 0===$(this).data("synonyms")){var t=new $.Synonyms(this,e);$(this).data("synonyms",t)}})};